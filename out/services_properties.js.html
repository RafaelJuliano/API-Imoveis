<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/properties.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/properties.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Property = require('../models/properties');

/*
PROPERTY SERVICE LAYER
Responsável por executar a regra de negócio e invocar o objeto Sequelize para operações no banco de dados.
*/

/** @module SERVICE PROPERTY*/

/**
 * Retorna um imóvel pelo seu ID
 * @param {Number} id - ID do imóvel 
 * @returns {Property} - Imóvel encontrado.
 */
exports.getProperty = async (id) => {
    const property = await Property.findByPk(id);
    return property;
}


/**
 * Retorna a quantidade (limit) do intervalo (page) dos imóveis cadastrados ordenados pelo id;
 * exemplo. (page = 2, limit = 10) Retorna intervalo entre 21 e 30.
 * @param {Number} setLimit - Tamanho do intervalo retornado.
 * @param {Number} setPage - Determina o intervalo retornado.
 * @returns {Proerty[]} - Array de objetos com imóveis.
 */
exports.getProperties = async (setLimit, setPage) => {
    let limit = setLimit;
    let page = setPage;

    //Impede que o limite seja maior que 20 ou negativo
    const ITENS_PER_PAGE = 20;
    limit = limit > ITENS_PER_PAGE || limit &lt;= 0 ? ITENS_PER_PAGE : limit;
    page = page &lt;= 0 ? 0 : page * limit;

    const properties = await Property.findAll({ limit: limit, offset: page });
    return properties;
};


/**
 * Cadastra um novo imóvel.
 * @param {Property} property - Objeto com dados do imóvel.
 * @returns {Property} - Objeto do imóvel cadastrado.
 */
exports.registerNewProperty = async (property) => {
    const newProperty = await Property.create({
        cep: property.cep,
        number: property.number,
        complement: property.complement,
        price: property.price,
        rooms: property.rooms
    });
    return newProperty;
}


/**
 * Atualiza um ou mais dados de um imóvel.
 * @param {Property} property - Objeto com dados a serem atualizados do imóvel. ID é obrigatório.
 * @returns {String} - updated || not found.
 */
exports.updateProperty = async (property) => {
    const propertyExist = await Property.findByPk(property.id);
    if (propertyExist) {
        const updated = await Property.update({
            number: property.number,
            cep: property.cep,
            complement: property.complement,
            price: property.price,
            rooms: property.rooms
        }, { where: { id: property.id } });
        if (updated) return 'updated';
    } else {
        return 'not found';
    }
}


/**
 * Deleta um imóvel.
 * @param {Number} id - Id do imóvel a ser deletado.
 * @returns {String} - String com confirmação se o imóvel foi deletado ou não encontrado.
 */
exports.deleteProperty = async (id) => {
    const propertyExist = await Property.findByPk(id);
    if (propertyExist) {
        const deleted = await Property.destroy({ where: { id: id } });
        if(deleted)  return 'deleted';
    } else {
        return 'not found';
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-CONTROLLER%2520PROPERTY.html">CONTROLLER PROPERTY</a></li><li><a href="module-CONTROLLER%2520USER.html">CONTROLLER USER</a></li><li><a href="module-MIDDLEWARE%2520JWT.html">MIDDLEWARE JWT</a></li><li><a href="module-SERVICE%2520PROPERTY.html">SERVICE PROPERTY</a></li><li><a href="module-SERVICE%2520SECURITY.html">SERVICE SECURITY</a></li><li><a href="module-SERVICE%2520USER.html">SERVICE USER</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Jun 08 2021 15:52:12 GMT-0300 (Horário Padrão de Brasília)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
